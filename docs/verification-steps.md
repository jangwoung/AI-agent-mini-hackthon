# 検証手順（Phase 1-5 完了時点）

**実装済み**: Phase 1 (Setup), Phase 2 (Foundational), Phase 3 (AI Integration), Phase 4 (User Story 1), Phase 5 (User Story 2)  
**未実装**: Phase 6 (User Story 3: AI レビュー生成)

---

## 前提条件

- `.env.local` が正しく設定されている（Firebase / Vertex AI）
- Firebase で課金が有効になっている
- Firestore の複合インデックスがデプロイ済み
- `npm run dev` で開発サーバーが起動している

---

## 1. 環境セットアップ確認

### 1.1 依存関係のインストール

```bash
cd /Users/jangwoung/workspace/hackthon/ai-agent-mini
npm install
```

### 1.2 型チェック・リント

```bash
npm run type-check
npm run lint
```

**期待結果**: エラーなし

### 1.3 開発サーバー起動

```bash
npm run dev
```

**期待結果**: `http://localhost:3000` でアクセス可能

---

## 2. User Story 1: 学習目標作成と 5 ステップ生成

### 2.1 トップページ確認

1. ブラウザで **http://localhost:3000** を開く
2. **「学習目標を作成 →」** ボタンが表示されることを確認
3. ボタンをクリック

**期待結果**: `/skill/new` に遷移

### 2.2 学習目標作成フォーム

1. **技術** ドロップダウンで **「Next.js」** を選択
2. **目標** テキストエリアに以下を入力（10 文字以上）:
   ```
   Next.js で CRUD できる TODO アプリを作る
   ```
3. **「5ステップを生成」** ボタンをクリック

**期待結果**:
- ボタンが **「生成中…」** に変わる
- 数秒〜数十秒待つと `/skill/[goalId]` にリダイレクト

### 2.3 ステップ一覧表示

1. `/skill/[goalId]` ページで以下を確認:
   - 画面上部に **目標テキスト**（「Next.js で CRUD できる TODO アプリを作る」）が表示
   - その下に **技術名**（「Next.js」）が表示
   - **5 個のステップカード** が番号順（1, 2, 3, 4, 5）で表示
   - 各カードに **ステップタイトル** が表示
   - 各カードに **番号バッジ**（未完了は数字、完了済みは ✓）が表示

**期待結果**: 5 ステップが正しく表示される

### 2.4 ステップカードのクリック

1. 任意のステップカードをクリック

**期待結果**: `/skill/[goalId]/steps/[stepId]` に遷移

---

## 3. User Story 2: ステップ詳細・提出物保存・完了チェック

### 3.1 ステップ詳細ページ確認

1. `/skill/[goalId]/steps/[stepId]` で以下を確認:
   - 上部に **「← ステップ一覧に戻る」** リンク
   - **ステップ番号バッジ** と **ステップタイトル**（例: 「Set up Next.js project」）
   - **完了チェックボックス**（未完了 / 完了済み）
   - **タスク** セクション（詳細なタスク説明）
   - **成果物** セクション（成果物の説明）
   - **提出物** セクション（提出フォーム）

**期待結果**: すべての要素が表示される

### 3.2 提出物の保存（コード）

1. **提出物** セクションで **「コード」** ラジオボタンを選択
2. テキストエリアに以下を入力:
   ```typescript
   // app/page.tsx
   export default function Home() {
     return <div>Hello World</div>
   }
   ```
3. **「保存」** ボタンをクリック

**期待結果**:
- ボタンが **「保存中…」** に変わる
- 数秒後に **「✓ 提出物を保存しました」** のメッセージが表示
- ページが自動リフレッシュされ、入力したコードが表示される

### 3.3 提出物の更新

1. 既存の提出物（コード）を編集
2. **「更新」** ボタンをクリック

**期待結果**: 更新された内容が保存され、表示される

### 3.4 提出物の保存（URL）

1. **「URL」** ラジオボタンを選択
2. URL 入力欄に以下を入力:
   ```
   https://github.com/user/my-nextjs-app
   ```
3. **「保存」** ボタンをクリック

**期待結果**: URL が保存され、表示される

### 3.5 完了チェックボックスの切り替え

1. **完了チェックボックス** をクリック（未完了 → 完了済み）

**期待結果**:
- チェックボックスがチェックされる
- ラベルが **「完了済み」** に変わる
- ページが自動リフレッシュされ、ステップ一覧ページ（`/skill/[goalId]`）で該当ステップのバッジが **✓** に変わる

2. 再度チェックボックスをクリック（完了済み → 未完了）

**期待結果**:
- チェックが外れる
- ラベルが **「未完了」** に変わる
- ステップ一覧でバッジが **数字** に戻る

---

## 4. エラーケースの確認

### 4.1 バリデーションエラー（目標が短すぎる）

1. `/skill/new` で **目標** に **9 文字以下**（例: `短い`）を入力
2. **「5ステップを生成」** をクリック

**期待結果**: フォームが送信されない、またはエラーメッセージが表示される

### 4.2 バリデーションエラー（URL が不正）

1. ステップ詳細ページで **「URL」** を選択
2. 不正な URL（例: `not-a-url`）を入力
3. **「保存」** をクリック

**期待結果**: エラーメッセージが表示される（「Content must be a valid URL when contentType is "url"」など）

### 4.3 ネットワークエラー（Vertex AI が失敗）

1. `.env.local` の `GOOGLE_APPLICATION_CREDENTIALS` を一時的に無効なパスに変更
2. 開発サーバーを再起動
3. 学習目標を作成して「5ステップを生成」をクリック

**期待結果**:
- ブラウザに **「AIステップ生成に失敗しました。再生成してください。」** が表示
- ターミナルに `[generate-steps]` で始まるエラーログが出力される

### 4.4 存在しないステップ ID

1. ブラウザで `/skill/[goalId]/steps/invalid-step-id` に直接アクセス

**期待結果**: 404 ページ（Not Found）が表示される

---

## 5. Firestore データの確認（オプション）

### 5.1 Firebase Console で確認

1. [Firebase Console](https://console.firebase.google.com/) を開く
2. プロジェクトを選択
3. **「Firestore Database」** → **「データ」** タブ
4. 以下のコレクションが作成されていることを確認:
   - `skillGoals`: 作成した目標が保存されている
   - `skillSteps`: 各目標に紐づく 5 ステップが保存されている
   - `submissions`: 提出物が保存されている（提出した場合）

**期待結果**: データが正しく保存されている

### 5.2 データ構造の確認

各ドキュメントのフィールドが正しいか確認:

**skillGoals**:
- `skillType`: `"nextjs"`, `"go"`, `"gcp"` のいずれか
- `goalText`: 文字列（10-500 文字）
- `createdAt`: タイムスタンプ

**skillSteps**:
- `goalId`: 親目標の ID
- `index`: 1-5 の数値
- `title`: ステップタイトル
- `task`: タスク説明
- `deliverable`: 成果物説明
- `done`: 真偽値
- `createdAt`: タイムスタンプ

**submissions**:
- `stepId`: 親ステップの ID
- `content`: 提出物の内容（コードまたは URL）
- `contentType`: `"code"` または `"url"`
- `createdAt`: タイムスタンプ

---

## 6. 動作確認チェックリスト

### User Story 1（目標作成・ステップ生成）

- [ ] トップページから `/skill/new` に遷移できる
- [ ] 技術選択（Next.js / Go / GCP）が動作する
- [ ] 目標入力（10-500 文字）のバリデーションが動作する
- [ ] 「5ステップを生成」で AI が 5 ステップを生成する
- [ ] 生成後、`/skill/[goalId]` にリダイレクトされる
- [ ] ステップ一覧に 5 ステップが表示される
- [ ] 各ステップカードにタイトルと番号が表示される
- [ ] ステップカードをクリックすると詳細ページに遷移する

### User Story 2（提出物保存・完了チェック）

- [ ] ステップ詳細ページが表示される
- [ ] ステップタイトル、タスク、成果物が表示される
- [ ] 提出物フォームで「コード」/「URL」を切り替えられる
- [ ] コードを入力して保存できる
- [ ] URL を入力して保存できる
- [ ] 保存後、提出物が表示される
- [ ] 提出物を更新できる
- [ ] 完了チェックボックスで完了状態を切り替えられる
- [ ] 完了状態がステップ一覧に反映される

### エラーハンドリング

- [ ] バリデーションエラーが適切に表示される
- [ ] AI 生成失敗時にエラーメッセージが表示される
- [ ] 存在しないリソースにアクセスすると 404 が表示される

---

## 7. トラブルシューティング

### 7.1 「AIステップ生成に失敗しました」

**確認事項**:
1. ターミナルの `[generate-steps]` ログを確認
2. 403 `BILLING_DISABLED` → 課金を有効化
3. 404 `Model was not found` → モデル ID を確認（`gemini-2.0-flash-001` を使用）
4. 認証エラー → `GOOGLE_APPLICATION_CREDENTIALS` のパスを確認

詳細は `docs/manual-verification.md` の **8.6** を参照。

### 7.2 「The query requires an index」

**対処**: `firebase deploy --only firestore:indexes` を実行

### 7.3 提出物が保存されない

**確認事項**:
1. ブラウザの開発者ツール（Network タブ）で `/api/skill/submission` のレスポンスを確認
2. ターミナルにエラーログが出ていないか確認
3. Firestore のルールがオープンになっているか確認（MVP 用）

---

## 8. 次のステップ（未実装）

Phase 6: User Story 3（AI レビュー生成）は未実装です。以下は動作しません:

- 「レビューを生成」ボタン
- レビューの表示（Keep / Problem / Try / Next）

---

**参考**: 
- セットアップ手順: `docs/manual-verification.md`
- 実装タスク: `specs/001-skill-steps/tasks.md`
